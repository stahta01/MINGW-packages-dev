From 0e318c1f7de90f0d949b643e0a1391a85cd72dbd Mon Sep 17 00:00:00 2001
From: Tim Stahlhut <stahta01@gmail.com>
Date: Thu, 3 Sep 2020 00:00:42 -0400
Subject: sdas code changes to m09pst.c

---
 sdcc/sdas/as6809/m09pst.c | 108 ++++----------------------------------
 1 file changed, 11 insertions(+), 97 deletions(-)

diff --git a/sdcc/sdas/as6809/m09pst.c b/sdcc/sdas/as6809/m09pst.c
index c064a23fb..7dbc21e74 100644
--- a/sdcc/sdas/as6809/m09pst.c
+++ b/sdcc/sdas/as6809/m09pst.c
@@ -25,69 +25,6 @@
 #include "asxxxx.h"
 #include "m6809.h"
 
-/*
- * Coding Banks
- */
-struct	bank	bank[2] = {
-    /*	The '_CODE' area/bank has a NULL default file suffix.	*/
-    {	NULL,		"_CSEG",	NULL,		0,	0,	0,	0,	0	},
-    {	&bank[0],	"_DSEG",	"_DS",		1,	0,	0,	0,	B_FSFX	}
-};
-
-/*
- * Coding Areas
- */
-struct	area	area[2] = {
-    {	NULL,		&bank[0],	"_CODE",	0,	0,	0,	A_1BYTE|A_BNK|A_CSEG	},
-    {	&area[0],	&bank[1],	"_DATA",	1,	0,	0,	A_1BYTE|A_BNK|A_DSEG	}
-};
-
-/*
- * Basic Relocation Mode Definition
- *
- *	#define		R_NORM	0000		No Bit Positioning
- */
-char	mode0[32] = {	/* R_NORM */
-	'\200',	'\201',	'\202',	'\203',	'\204',	'\205',	'\206',	'\207',
-	'\210',	'\211',	'\212',	'\213',	'\214',	'\215',	'\216',	'\217',
-	'\220',	'\221',	'\222',	'\223',	'\224',	'\225',	'\226',	'\227',
-	'\230',	'\231',	'\232',	'\233',	'\234',	'\235',	'\236',	'\237'
-};
-
-/*
- * Additional Relocation Mode Definitions
- */
-
-/* None Required */
-
-/*
- *     *m_def is a pointer to the bit relocation definition.
- *	m_flag indicates that bit position swapping is required.
- *	m_dbits contains the active bit positions for the output.
- *	m_sbits contains the active bit positions for the input.
- *
- *	struct	mode
- *	{
- *		char *	m_def;		Bit Relocation Definition
- *		a_uint	m_flag;		Bit Swapping Flag
- *		a_uint	m_dbits;	Destination Bit Mask
- *		a_uint	m_sbits;	Source Bit Mask
- *	};
- */
-struct	mode	mode[1] = {
-    {	&mode0[0],	0,	0x0000FFFF,	0x0000FFFF	}
-};
-
-/*
- * Array of Pointers to mode Structures
- */
-struct	mode	*modep[16] = {
-	&mode[0],	NULL,		NULL,		NULL,
-	NULL,		NULL,		NULL,		NULL,
-	NULL,		NULL,		NULL,		NULL,
-	NULL,		NULL,		NULL,		NULL
-};
-
 /*
  * Mnemonic Structure
  */
@@ -95,14 +32,10 @@ struct	mne	mne[] = {
 
 	/* machine */
 
-    {	NULL,	"CSEG",		S_ATYP,		0,	A_CSEG|A_1BYTE	},
-    {	NULL,	"DSEG",		S_ATYP,		0,	A_DSEG|A_1BYTE	},
-
     {	NULL,	".setdp",	S_SDP,		0,	0	},
 
 	/* system */
 
-    {	NULL,	"BANK",		S_ATYP,		0,	A_BNK	},
     {	NULL,	"CON",		S_ATYP,		0,	A_CON	},
     {	NULL,	"OVR",		S_ATYP,		0,	A_OVR	},
     {	NULL,	"REL",		S_ATYP,		0,	A_REL	},
@@ -110,10 +43,10 @@ struct	mne	mne[] = {
     {	NULL,	"NOPAG",	S_ATYP,		0,	A_NOPAG	},
     {	NULL,	"PAG",		S_ATYP,		0,	A_PAG	},
 
-    {	NULL,	"BASE",		S_BTYP,		0,	B_BASE	},
-    {	NULL,	"SIZE",		S_BTYP,		0,	B_SIZE	},
-    {	NULL,	"FSFX",		S_BTYP,		0,	B_FSFX	},
-    {	NULL,	"MAP",		S_BTYP,		0,	B_MAP	},
+    {   NULL,   "CODE",         S_ATYP,         0,      A_CODE  },
+    {   NULL,   "DATA",         S_ATYP,         0,      A_DATA  },
+    {   NULL,   "LOAD",         S_ATYP,         0,      A_LOAD  },
+    {   NULL,   "NOLOAD",       S_ATYP,         0,      A_NOLOAD },
 
     {	NULL,	".page",	S_PAGE,		0,	0	},
     {	NULL,	".title",	S_HEADER,	0,	O_TITLE	},
@@ -121,7 +54,6 @@ struct	mne	mne[] = {
     {	NULL,	".module",	S_MODUL,	0,	0	},
     {	NULL,	".include",	S_INCL,		0,	0	},
     {	NULL,	".area",	S_AREA,		0,	0	},
-    {	NULL,	".bank",	S_BANK,		0,	0	},
     {	NULL,	".org",		S_ORG,		0,	0	},
     {	NULL,	".radix",	S_RADIX,	0,	0	},
     {	NULL,	".globl",	S_GLOBL,	0,	0	},
@@ -130,38 +62,28 @@ struct	mne	mne[] = {
     {	NULL,	".iff",		S_CONDITIONAL,	0,	O_IFF	},
     {	NULL,	".ift",		S_CONDITIONAL,	0,	O_IFT	},
     {	NULL,	".iftf",	S_CONDITIONAL,	0,	O_IFTF	},
-    {	NULL,	".ifdef",	S_CONDITIONAL,	0,	O_IFDEF	},
-    {	NULL,	".ifndef",	S_CONDITIONAL,	0,	O_IFNDEF},
     {	NULL,	".ifgt",	S_CONDITIONAL,	0,	O_IFGT	},
     {	NULL,	".iflt",	S_CONDITIONAL,	0,	O_IFLT	},
     {	NULL,	".ifge",	S_CONDITIONAL,	0,	O_IFGE	},
     {	NULL,	".ifle",	S_CONDITIONAL,	0,	O_IFLE	},
     {	NULL,	".ifeq",	S_CONDITIONAL,	0,	O_IFEQ	},
     {	NULL,	".ifne",	S_CONDITIONAL,	0,	O_IFNE	},
-    {	NULL,	".ifb",		S_CONDITIONAL,	0,	O_IFB	},
-    {	NULL,	".ifnb",	S_CONDITIONAL,	0,	O_IFNB	},
-    {	NULL,	".ifidn",	S_CONDITIONAL,	0,	O_IFIDN	},
-    {	NULL,	".ifdif",	S_CONDITIONAL,	0,	O_IFDIF	},
     {	NULL,	".iif",		S_CONDITIONAL,	0,	O_IIF	},
     {	NULL,	".iiff",	S_CONDITIONAL,	0,	O_IIFF	},
     {	NULL,	".iift",	S_CONDITIONAL,	0,	O_IIFT	},
     {	NULL,	".iiftf",	S_CONDITIONAL,	0,	O_IIFTF	},
-    {	NULL,	".iifdef",	S_CONDITIONAL,	0,	O_IIFDEF},
-    {	NULL,	".iifndef",	S_CONDITIONAL,	0,	O_IIFNDEF},
     {	NULL,	".iifgt",	S_CONDITIONAL,	0,	O_IIFGT	},
     {	NULL,	".iiflt",	S_CONDITIONAL,	0,	O_IIFLT	},
     {	NULL,	".iifge",	S_CONDITIONAL,	0,	O_IIFGE	},
     {	NULL,	".iifle",	S_CONDITIONAL,	0,	O_IIFLE	},
     {	NULL,	".iifeq",	S_CONDITIONAL,	0,	O_IIFEQ	},
     {	NULL,	".iifne",	S_CONDITIONAL,	0,	O_IIFNE	},
-    {	NULL,	".iifb",	S_CONDITIONAL,	0,	O_IIFB	},
-    {	NULL,	".iifnb",	S_CONDITIONAL,	0,	O_IIFNB	},
-    {	NULL,	".iifidn",	S_CONDITIONAL,	0,	O_IIFIDN},
-    {	NULL,	".iifdif",	S_CONDITIONAL,	0,	O_IIFDIF},
     {	NULL,	".else",	S_CONDITIONAL,	0,	O_ELSE	},
     {	NULL,	".endif",	S_CONDITIONAL,	0,	O_ENDIF	},
     {	NULL,	".list",	S_LISTING,	0,	O_LIST	},
     {	NULL,	".nlist",	S_LISTING,	0,	O_NLIST	},
+    {   NULL,   ".uleb128",     S_ULEB128,      0,      0       },
+    {   NULL,   ".sleb128",     S_SLEB128,      0,      0       },
     {	NULL,	".equ",		S_EQU,		0,	O_EQU	},
     {	NULL,	".gblequ",	S_EQU,		0,	O_GBLEQU},
     {	NULL,	".lclequ",	S_EQU,		0,	O_LCLEQU},
@@ -189,22 +111,14 @@ struct	mne	mne[] = {
     {	NULL,	".strs",	S_ASCIX,	0,	O_ASCIS	},
     {	NULL,	".strz",	S_ASCIX,	0,	O_ASCIZ	},
     {	NULL,	".fcc",		S_ASCIX,	0,	O_ASCII	},
-    {	NULL,	".define",	S_DEFINE,	0,	O_DEF	},
-    {	NULL,	".undefine",	S_DEFINE,	0,	O_UNDEF	},
     {	NULL,	".even",	S_BOUNDARY,	0,	O_EVEN	},
     {	NULL,	".odd",		S_BOUNDARY,	0,	O_ODD	},
     {	NULL,	".bndry",	S_BOUNDARY,	0,	O_BNDRY	},
-    {	NULL,	".msg"	,	S_MSG,		0,	0	},
-    {	NULL,	".assume",	S_ERROR,	0,	O_ASSUME},
-    {	NULL,	".error",	S_ERROR,	0,	O_ERROR	},
-/*    {	NULL,	".msb",		S_MSB,		0,	0	},	*/
-/*    {	NULL,	".lohi",	S_MSB,		0,	O_LOHI	},	*/
-/*    {	NULL,	".hilo",	S_MSB,		0,	O_HILO	},	*/
-/*    {	NULL,	".8bit",	S_BITS,		0,	O_1BYTE	},	*/
-/*    {	NULL,	".16bit",	S_BITS,		0,	O_2BYTE	},	*/
-/*    {	NULL,	".24bit",	S_BITS,		0,	O_3BYTE	},	*/
-/*    {	NULL,	".32bit",	S_BITS,		0,	O_4BYTE	},	*/
-    {	NULL,	".end",		S_END,		0,	0	},
+/* sdas specific */
+    {   NULL,   ".optsdcc",     S_OPTSDCC,      0,      0       },
+/* end sdas specific */
+//    { NULL,   ".assume",      S_ERROR,        0,      0       },
+//    { NULL,   ".error",       S_ERROR,        0,      1       },
 
 	/* Macro Processor */
 
-- 
2.28.0.windows.1

